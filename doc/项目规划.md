## åŠŸèƒ½åˆ†æï¼š

:one: ç”¨æˆ·æ‰“å¡å­¦ä¹ 
:two: åˆ¶å®šä»»åŠ¡ï¼Œæ‰“å¡ä»»åŠ¡
:three: ç”¨æˆ·å’Œç”¨æˆ·å¯ä»¥ç»‘å®šå…³ç³»
:four: æ‰“å¡åˆ°ä¸€å®šæœºåˆ¶å¼€å¯å¥–åŠ±æœºåˆ¶

## æ•°æ®è®¾è®¡:

:one: ç”¨æˆ·è¡¨ï¼Œè®°å½•ç”¨æˆ·çš„ä¿¡æ¯
:two: ä»»åŠ¡è¡¨ï¼Œè®°å½•ç”¨æˆ·çš„ä»»åŠ¡ä¿¡æ¯
:three: å…³ç³»è¡¨ï¼Œç”¨äºè®°å½•ç”¨æˆ·å’Œç”¨æˆ·ä¹‹é—´çš„å…³ç³»

## é€‰æ‹©å·¥å…·ä½¿ç”¨ï¼š

:one: æ•°æ®åº“`Mariadb`
:two: åç«¯æ¡†æ¶ï¼š`SpringBoot`
:three: æ•°æ®åº“æ¡†æ¶ï¼š`MybatisPlus`
:four: å‰ç«¯æ¡†æ¶ï¼š`Vue`
:five: è®¤è¯æ¡†æ¶ï¼š`SaToken`

## åŠŸèƒ½å®ç°ï¼š

### ğŸŒŸ: æ•°æ®åº“å®ç°

:one: ç”¨æˆ·è¡¨

```mariadbğŸŒŸ
+------------+--------------+------+-----+---------+-------+
| Field      | Type         | Null | Key | Default | Extra |
+------------+--------------+------+-----+---------+-------+
| id         | int(18)      | NO   | PRI | NULL    |       |
| name       | varchar(30)  | NO   |     | NULL    |       |
| password   | varchar(30)  | NO   |     | NULL    |       |
| learn_date | int(11)      | YES  |     | NULL    |       |
| task       | varchar(255) | YES  |     | NULL    |       |
+------------+--------------+------+-----+---------+-------+
```

:two: ä»»åŠ¡è¡¨

```mariadb
+------------+--------------+------+-----+---------+-------+
| Field      | Type         | Null | Key | Default | Extra |
+------------+--------------+------+-----+---------+-------+
| user_id    | int(11)      | NO   | MUL | NULL    |       |
| task_name  | varchar(50)  | NO   |     | NULL    |       |
| task_field | varchar(255) | NO   |     |         |       |
| level      | int(11)      | YES  |     | NULL    |       |
+------------+--------------+------+-----+---------+-------+
```

:three: å…³ç³»è¡¨

```mariadb
+------------+--------------+------+-----+---------+-------+
| Field      | Type         | Null | Key | Default | Extra |
+------------+--------------+------+-----+---------+-------+
| user_id    | int(11)      | NO   | MUL | NULL    |       |
| task_name  | varchar(50)  | NO   |     | NULL    |       |
| task_field | varchar(255) | NO   |     |         |       |
| level      | int(11)      | YES  |     | NULL    |       |
+------------+--------------+------+-----+---------+-------+
```

### ğŸŒŸ: åç«¯å®ç°

åç«¯ç»“æ„: ä½¿ç”¨çš„æ˜¯`SpringBoot`+`MybatisPlus`, `SaToken`ç”¨äºå®ç°ç”¨æˆ·è®¤è¯,è¿™äº›éœ€è¦åœ¨`pom.xml`ä¸­å¼•å…¥ç›¸å…³ä¾èµ–
`model`åŒ… æ•°æ®å®ä½“ç±»
`dao`åŒ…   ç”¨äºå’Œæ•°æ®åº“è¿›è¡Œäº¤äº’
`service`åŒ… ç”¨äºå¤„ç†æ¥å—åˆ°çš„è¯·æ±‚
`config`åŒ…  ç”¨äºé…ç½®ä¸€äº›`tools`çš„`config`
`control`åŒ… ç”¨äºæ¥å—ç”¨æˆ·çš„è¯·æ±‚

#### :one: springbooté…ç½®

:warning: ä¿®æ”¹ä¸º`yaml`æ ¼å¼

```yaml
spring:
  datasource:
    username: root
    password: 123456
    url: jdbc:mariadb://localhost:3306/selfclocking
    driver-class-name: org.mariadb.jdbc.Driver
  jpa:
    hibernate:
      ddl-auto: create
############## Sa-Token é…ç½® (æ–‡æ¡£: https://sa-token.cc) ##############
sa-token:
  # token åç§°ï¼ˆåŒæ—¶ä¹Ÿæ˜¯ cookie åç§°ï¼‰
  token-name: satoken
  # token æœ‰æ•ˆæœŸï¼ˆå•ä½ï¼šç§’ï¼‰ é»˜è®¤30å¤©ï¼Œ-1 ä»£è¡¨æ°¸ä¹…æœ‰æ•ˆ
  timeout: 2592000
  # token æœ€ä½æ´»è·ƒé¢‘ç‡ï¼ˆå•ä½ï¼šç§’ï¼‰ï¼Œå¦‚æœ token è¶…è¿‡æ­¤æ—¶é—´æ²¡æœ‰è®¿é—®ç³»ç»Ÿå°±ä¼šè¢«å†»ç»“ï¼Œé»˜è®¤-1 ä»£è¡¨ä¸é™åˆ¶ï¼Œæ°¸ä¸å†»ç»“
  active-timeout: -1
  # æ˜¯å¦å…è®¸åŒä¸€è´¦å·å¤šåœ°åŒæ—¶ç™»å½• ï¼ˆä¸º true æ—¶å…è®¸ä¸€èµ·ç™»å½•, ä¸º false æ—¶æ–°ç™»å½•æŒ¤æ‰æ—§ç™»å½•ï¼‰
  is-concurrent: true
  # åœ¨å¤šäººç™»å½•åŒä¸€è´¦å·æ—¶ï¼Œæ˜¯å¦å…±ç”¨ä¸€ä¸ª token ï¼ˆä¸º true æ—¶æ‰€æœ‰ç™»å½•å…±ç”¨ä¸€ä¸ª token, ä¸º false æ—¶æ¯æ¬¡ç™»å½•æ–°å»ºä¸€ä¸ª tokenï¼‰
  is-share: true
  # token é£æ ¼ï¼ˆé»˜è®¤å¯å–å€¼ï¼šuuidã€simple-uuidã€random-32ã€random-64ã€random-128ã€tikï¼‰
  token-style: uuid
  # æ˜¯å¦è¾“å‡ºæ“ä½œæ—¥å¿—
  is-log: true

```

#### :two: modle

:star: ä¸‰ä¸ªè¡¨æ¯ä¸€ä¸ªè¡¨å¯¹åº”ä¸€ä¸ªå®ä½“ç±»ï¼Œåˆ†åˆ«æ˜¯`UserModle`,`UserTask`,`Relationship`
:star: å®ä½“ç±»é€šå¸¸éœ€è¦æ‰“ä¸‰ä¸ªæ ‡ç­¾é€šå¸¸æ˜¯`@Data`ã€`@AllArgsConstructor`ã€`@NoArgsConstructor`ï¼Œè¿™ä¸‰ä¸ªæ ‡ç­¾éƒ½æ˜¯`lombok`çš„æ³¨è§£ï¼Œå¯ä»¥å‡å°‘å¾ˆå¤šé‡å¤çš„ä»£ç ï¼Œå®ƒå¯ä»¥ç”Ÿæˆæ„é€ å‡½æ•°ã€getterã€setterã€toString æ–¹æ³•ï¼Œ
:star: `@TableNmae` è¡¨ç¤ºæ•°æ®åº“ä¸­çš„è¡¨å
:star: åœ¨å®ä½“ç±»ä¸­ï¼Œ`@TableId`è¡¨ç¤ºæ•°æ®åº“ä¸­çš„ä¸»é”®ï¼Œ`@TableField`è¡¨ç¤ºæ•°æ®åº“ä¸­çš„å­—æ®µï¼Œ`@TableName`è¡¨ç¤ºæ•°æ®åº“ä¸­çš„è¡¨åï¼Œ`insertStrategy = FieldStrategy.IGNORED` è¡¨ç¤ºè¯¥å­—æ®µåœ¨æ’å…¥æ—¶æ˜¯å¦å¿½ç•¥ï¼Œ`exist = false`è¡¨ç¤ºè¯¥å­—æ®µåœ¨æŸ¥è¯¢æ—¶æ˜¯å¦å¿½ç•¥

```java
// UserModle.java
package fun.tanc.selfclocking.model;

import com.baomidou.mybatisplus.annotation.*;
import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;

@Data
@AllArgsConstructor
@NoArgsConstructor
@TableName("user")
public class UserModel {
    /*
     * id
     * name
     * password
     * learnDate
     * task
     * */
    @TableId(value = "id", type = IdType.ASSIGN_UUID) // æŒ‡å®šä¸»é”®çš„ç”Ÿæˆæ–¹å¼
    private Long id;

    @TableField(value = "name")
    private String name;

    @TableField(value = "password")
    private String password;

    @TableField(value = "learn_date",insertStrategy = FieldStrategy.IGNORED,exist = false)
    private int learnDate;

    @TableField(value = "task",insertStrategy = FieldStrategy.IGNORED,exist = false)
    private String task;

    public UserModel(long id,String name, String password) {
        this.name = name;
        this.password = password;
        this.id = id;
    }
}

```

```java
// UserTask.java
package fun.tanc.selfclocking.model;

import com.baomidou.mybatisplus.annotation.TableField;
import com.baomidou.mybatisplus.annotation.TableId;
import com.baomidou.mybatisplus.annotation.TableLogic;
import com.baomidou.mybatisplus.annotation.TableName;
import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;
import org.springframework.boot.autoconfigure.domain.EntityScan;

@Data
@AllArgsConstructor
@NoArgsConstructor
@TableName("usertask")
public class UserTask {
    @TableId(value = "user_id")
    private long id;

    @TableField(value = "task_name")
    private String taskName;

    @TableField(value = "level",exist = false)
    private int taskLevel;

    @TableField(value = "task_field")
    private String taskField;



    public UserTask(long id, String taskName, String taskField) {
        this.id = id;
        this.taskName = taskName;
        this.taskField = taskField;
    }
}


```

```java
//Relationship.java
package fun.tanc.selfclocking.model;

import com.baomidou.mybatisplus.annotation.IdType;
import com.baomidou.mybatisplus.annotation.TableField;
import com.baomidou.mybatisplus.annotation.TableId;
import com.baomidou.mybatisplus.annotation.TableName;
import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.time.LocalDateTime;
import java.util.Date;

@Data
@AllArgsConstructor
@NoArgsConstructor
@TableName("relationship")
public class Relationship {
    @TableId(value = "r_id",type = IdType.AUTO)
    private long id;

    @TableField(value = "user_one")
    private long userOneId;

    @TableField("user_two")
    private long userTwoId;

    @TableField("relationship")
    private String relationship;

    @TableField(value = "day",exist = false)
    private Date day;

    @TableField(value = "time")
    private LocalDateTime time;

    public Relationship(Long uid1, Long uid2, String relationship, LocalDateTime now) {
        this.userOneId = uid1;
        this.userTwoId = uid2;
        this.relationship = relationship;
        this.time = now;
    }
}

```

#### :three: daoåŒ…

:star: `MybatisPlus`çš„`BaseMapper`ç±»ä¸­å·²ç»å°è£…äº†å¾ˆå¤šæ–¹æ³•ï¼ŒåŒ…æ‹¬`insert`ã€`delete`ã€`update`ã€`select`ç­‰ï¼Œæ‰€ä»¥ä¸éœ€è¦è‡ªå·±å†™sqlè¯­å¥ï¼Œåªéœ€è¦å†™å®ä½“ç±»å’Œmapperæ¥å£å³å¯ï¼Œä½†æ˜¯æˆ‘åœ¨è®¾è®¡è¡¨çš„æ—¶å€™è¿˜æ˜¯èµ°äº†å¾ˆå¤šå¼¯è·¯ï¼Œåœ¨è®¾è®¡ä»»åŠ¡è¡¨çš„æ—¶å€™ç”±äºæƒ³æ³•æ²¡åˆ°ä½ï¼Œå†™äº†å¾ˆå¤š`sql`ï¼Œå‘ç°è¿˜æ˜¯èµ°ä¸é€šï¼Œçªç„¶å°±æƒ³åˆ°äº†ä¸€ä¸ªæ›´å¥½çš„åŠæ³•ï¼Œä¸‹é¢æ˜¯æˆ‘èµ°çš„å¼¯è·¯(åœ¨`UserTaskDao`ç±»ä¸­å†™çš„ä¸€äº›sql)

```java
// UserTaskDao.java

package fun.tanc.selfclocking.dao;

import com.baomidou.mybatisplus.core.mapper.BaseMapper;
import fun.tanc.selfclocking.model.UserTask;
import org.apache.ibatis.annotations.*;

import java.util.List;

@Mapper
public interface UserTaskDao  extends  BaseMapper<UserTask>{
//    //åˆ›å»ºä»»åŠ¡è¡¨
//    @Insert("CREATE TABLE ${tableName} ( user_id INT PRIMARY KEY, foreign key(user_id) references user(id) on delete cascade on update cascade)")
//    void createTaskTable(@Param("tableName") String tableName) throws Exception;
//
//    //æ’å…¥ç”¨æˆ·id
//    @Insert("insert into ${tableName} (user_id) values (${userId})")
//    void insertUserId(@Param("userId") long userId,@Param("tableName") String tableName) throws Exception;
//
//    //æ’å…¥ä»»åŠ¡å
//    @Insert("alter table ${tableName} add column ${taskName} varchar(255)")
//    void alterTaskTable(@Param("tableName") String tableName,@Param("taskName") String taskName) throws Exception;
//
//    //æ’å…¥ä»»åŠ¡å†…å®¹
//    @Update("update ${tableName} set ${taskName} = ${taskStr} where user_id = ${user_id}")
//    void insertTask(@Param("tableName") String tableName,@Param("taskName") String taskName,@Param("user_id") long userId,@Param("taskStr") String taskStr) throws Exception;
//
//    //åˆ é™¤ç”¨æˆ·ä»»åŠ¡
//    @Insert("alter table $(tableNmae) drop $(taskName)")
//    void deleteUserTask(@Param("tableName") String tableName,@Param("taskName") String taskName) throws Exception;
//
//    //åˆ é™¤ç”¨æˆ·è¡¨
//    @Delete("drop table ${tableName}")
//    void deleteUserTable(@Param("tableName") String tableName) throws Exception;
//
//    //åˆ—å‡ºä»»åŠ¡è¡¨
//    @Select("<script>" +
//            "SELECT " +
//            "<if test= 'false'> user_id,</if>" + // æ ¹æ®æ¡ä»¶å†³å®šæ˜¯å¦åŒ…å« password å­—æ®µ
//            "* " + // å…¶ä»–å­—æ®µ
//            "FROM ${tableName}" +
//            "</script>")
//    List<UserTask> listUserTask(@Param("tableName") String tableName) throws Exception;
}
```

```java
//UserDao.java
package fun.tanc.selfclocking.dao;

import com.baomidou.mybatisplus.core.mapper.BaseMapper;
import fun.tanc.selfclocking.model.UserModel;
import org.apache.ibatis.annotations.Mapper;

@Mapper
public interface UserDao extends BaseMapper<UserModel> {
}

```

```java
//RelationshipDao.java

package fun.tanc.selfclocking.dao;

import com.baomidou.mybatisplus.core.mapper.BaseMapper;
import fun.tanc.selfclocking.model.Relationship;
import org.apache.ibatis.annotations.Mapper;

@Mapper
public interface RelationshipDao extends BaseMapper<Relationship> {
}

```

#### :four: service

:star: `@Service`æ³¨è§£è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªæœåŠ¡å±‚ï¼Œç”¨æ¥è°ƒç”¨daoå±‚çš„æ–¹æ³•ï¼Œ`@Transactional`æ³¨è§£è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªäº‹åŠ¡ï¼Œå¦‚æœæ–¹æ³•ä¸­æœ‰å¼‚å¸¸ï¼Œåˆ™ä¼šå›æ»šï¼ˆæ³¨æ„ä¸éœ€è¦åœ¨trycatchä¸­æ•è·å¼‚å¸¸ï¼Œå¦åˆ™ä¼šå¯¼è‡´äº‹åŠ¡å¤±æ•ˆï¼‰
:star: @Autowiredæ³¨è§£è¡¨ç¤ºè‡ªåŠ¨æ³¨å…¥ï¼Œä¸éœ€è¦æ‰‹åŠ¨newå¯¹è±¡ï¼Œç›´æ¥ä½¿ç”¨å³å¯
:star: ç›´æ¥è°ƒç”¨`mybatisplus`æä¾›çš„æ–¹æ³•å³å¯ï¼Œä¹Ÿæ˜¯å°±åœ¨daoåŒ…ä¸­ï¼Œç›´æ¥è°ƒç”¨daoåŒ…çš„å®ç°çš„æ–¹æ³•,è¿™é‡Œå¯ä»¥å®ç°åƒç™»å½•åˆ é™¤ç”¨æˆ·æ³¨å†Œç”¨æˆ·ç­‰åŠŸèƒ½

```java
//UserServiceImpl.java
package fun.tanc.selfclocking.service;

import com.baomidou.mybatisplus.core.conditions.query.QueryWrapper;
import com.baomidou.mybatisplus.core.toolkit.Constants;
import fun.tanc.selfclocking.dao.UserDao;
import fun.tanc.selfclocking.dao.UserTaskDao;
import fun.tanc.selfclocking.model.UserModel;
import fun.tanc.selfclocking.model.UserTask;
import org.apache.ibatis.annotations.Param;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import java.util.List;
import java.util.UUID;

@Service
@Transactional(rollbackFor = Exception.class) //å›æ»š
public class UserServiceImpl {

    @Autowired
    private UserDao userDao;

    @Autowired
    private UserTaskDao userTaskDao;

    //åˆ›å»ºç”¨æˆ·
    @Transactional(rollbackFor = Exception.class)
    public Boolean addUser(String name,String password)
    {
        //æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å­˜åœ¨
        UserModel user = findUser(name);
        if (user != null){
            System.out.println("å½“å‰ç”¨æˆ·å·²ç»å­˜åœ¨ï¼ï¼");
            return false;
        }

        //ç”ŸæˆUUID
        long id = 0;
        //å¦‚æœç”Ÿæˆçš„idä¸º0æˆ–è€…å°äº0å°±åœ¨ç”Ÿæˆä¸€æ¬¡
        while (id <= 0) {
            id = UUID.randomUUID().hashCode();
        }

        //æ’å…¥ç”¨æˆ·
        int insert = userDao.insert(new UserModel(id, name, password));
        if (insert < 0){
            return false;
        }

        return true;
    }


    //æŸ¥æ‰¾ç”¨æˆ·(ç²¾ç¡®)
    public UserModel findUser(String name)
    {
        //æŸ¥è¯¢ç”¨æˆ·
        UserModel n = userDao.selectOne(new QueryWrapper<UserModel>().eq("name", name));
//        System.out.println(n);
        return n;
    }

    //æŸ¥æ‰¾ç”¨æˆ·(æ¨¡ç³Š)
    public List<UserModel> finderUserName(String name)
    {
        //æŸ¥è¯¢ç”¨æˆ·
        List<UserModel> n = userDao.selectList(new QueryWrapper<UserModel>().like("name", name));
        n.forEach(System.out::println);
        return n;
    }

    //æŸ¥æ‰¾ç”¨æˆ·

    //åˆ é™¤ç”¨æˆ·
    public boolean deleteUser(String name){
        //æŸ¥è¯¢ç”¨æˆ·
        UserModel user = findUser(name);
        //å¦‚æœç”¨æˆ·ä¸å­˜åœ¨åˆ™è¿”å›false
        if(user == null) return false;

        //è·å–ç”¨æˆ·idï¼Œæ ¹æ®idåˆ é™¤ç”¨æˆ·
        Long id = user.getId();
        System.out.println(id);
        userDao.deleteById(id);

        return true;
    }
}

```

```java
//UserTaskServiceImpl.java
package fun.tanc.selfclocking.service;

import com.baomidou.mybatisplus.core.conditions.query.QueryWrapper;
import com.baomidou.mybatisplus.core.conditions.update.UpdateWrapper;
import fun.tanc.selfclocking.dao.UserDao;
import fun.tanc.selfclocking.dao.UserTaskDao;
import fun.tanc.selfclocking.model.UserModel;
import fun.tanc.selfclocking.model.UserTask;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import java.util.List;

@Service
@Transactional(rollbackFor = Exception.class)
public class UserTaskServiceImpl {
    @Autowired
    UserServiceImpl usImpl;
    @Autowired
    UserTaskDao userTaskDao;

    //æ·»åŠ ä»»åŠ¡å­—æ®µ
    @Transactional(rollbackFor = Exception.class)
    public Boolean addUserTask(String userName,String taskName,String taskStr){
        //æŸ¥æ‰¾ç”¨æˆ·æ˜¯å¦å­˜åœ¨
        UserModel userModel = usImpl.findUser(userName);
        if (userModel == null) {
            System.out.println("ç”¨æˆ·ä¸å­˜åœ¨");
            return false;
        }
        //è·å–ç”¨æˆ·id
        long userID = userModel.getId();

        //æŸ¥æ‰¾æ­¤ä»»åŠ¡æ˜¯å¦å·²ç»å­˜åœ¨(ä¾ç…§ä»»åŠ¡å)
        if (userTaskDao.selectOne(new QueryWrapper<UserTask>().eq("user_id",userID ).eq("task_name", taskName)) != null) {
            System.out.println("ä»»åŠ¡å·²å­˜åœ¨");
            return false;
        }




        //æ›´æ–°ç”¨æˆ·taskå­—æ®µ
        int insert = userTaskDao.insert(new UserTask(userID, taskName, taskStr));
        if (insert < 0) {
            System.out.println("æ·»åŠ å¤±è´¥");
            return false;
        }

        return true;
    }

    //åˆ é™¤ä»»åŠ¡å­—æ®µ
    public void deleteUserTask(String userName,String taskName){
        UserModel userModel = usImpl.findUser(userName);
        QueryWrapper<UserTask> eq = new QueryWrapper<UserTask>().eq("user_id", userModel.getId()).eq("task_name", taskName);
        int delete = userTaskDao.delete(eq);
        System.out.println(delete);
    }

    //åˆ—å‡ºæ‰€æœ‰ä»»åŠ¡å­—æ®µ
    public List<UserTask> findUserTask(String userName){
        UserModel userModel = usImpl.findUser(userName);
        return userTaskDao.selectList(new QueryWrapper<UserTask>().eq("user_id", userModel.getId()));
    }

    //æŸ¥è¯¢ä»»åŠ¡å­—æ®µ(æ¨¡ç³Š)
    public List<UserTask> finderUserTask(String userName,String taskName){
        UserModel userModel = usImpl.findUser(userName);
        List<UserTask> userTasks = userTaskDao.selectList(new QueryWrapper<UserTask>().eq("user_id", userModel.getId()).like("task_name", taskName));
        userTasks.forEach(System.out::println);
        return userTasks;
    }
}

```

```java
//RelationServiceImpl.java
package fun.tanc.selfclocking.service;

import com.baomidou.mybatisplus.core.conditions.query.QueryWrapper;
import fun.tanc.selfclocking.dao.RelationshipDao;
import fun.tanc.selfclocking.dao.UserDao;
import fun.tanc.selfclocking.model.Relationship;
import fun.tanc.selfclocking.model.UserModel;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import java.sql.Time;
import java.time.LocalDateTime;

@Service
public class RelationServiceImpl {
    @Autowired
    private RelationshipDao relationshipDao;

    @Autowired
    private UserServiceImpl userService;

    @Autowired
    private UserDao userDao;


    //æ·»åŠ å…³ç³»
    public Boolean addRelation(String userName,String friendName,String relationship){
        //æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å­˜åœ¨
        UserModel user1 = userService.findUser(userName);
        UserModel user2 = userService.findUser(friendName);
        if(user1 ==null|| user2 ==null){
            System.out.println("ç”¨æˆ·ä¸å­˜åœ¨");
            return false;
        }

        //æ·»åŠ å…³ç³»

        //åˆ¤æ–­å…³ç³»æ˜¯å¦å­˜åœ¨
        Relationship re = relationshipDao.selectOne(new QueryWrapper<Relationship>().eq("user_one", user1.getId()).eq("user_two", user2.getId()));
        if(re != null){
            System.out.println("å…³ç³»å·²å­˜åœ¨");
            return false;
        }

        //æ·»åŠ å…³ç³»
        int insert = relationshipDao.insert(new Relationship(user1.getId(), user2.getId(), relationship, LocalDateTime.now()));
        if(insert <= 0){
            System.out.println("æ·»åŠ å¤±è´¥");
            return false;
        }

        return true;
    }

    //è§£é™¤å…³ç³»
    public Boolean deleteRelation(String userName,String friendName){
        UserModel user1 = userService.findUser(userName);
        UserModel user2 = userService.findUser(friendName);
        Relationship relationship = relationshipDao.selectOne(new QueryWrapper<Relationship>().eq("user_one", user1.getId()).eq("user_two", user2.getId()));
        //åˆ é™¤å…³ç³»
        relationshipDao.delete(new QueryWrapper<Relationship>().eq("r_id",relationship.getId()));

        return true;
    }


    //æŸ¥æ‰¾ç”¨æˆ·å­˜åœ¨çš„å…³ç³»
    public Relationship findRelation(String userName){
        UserModel user1 = userService.findUser(userName);
        return relationshipDao.selectOne(new QueryWrapper<Relationship>().eq("user_one", user1.getId()));
    }

}

```

#### :five: control

:star: `controller`å±‚ä¸»è¦å°è£…äº†`service`å±‚å’Œ`dao`å±‚ï¼Œä¸»è¦åŠŸèƒ½æ˜¯æ¥æ”¶å‰ç«¯è¯·æ±‚ï¼Œè°ƒç”¨`service`å±‚å’Œ`dao`å±‚è¿›è¡Œä¸šåŠ¡å¤„ç†ï¼Œç„¶åè¿”å›ç»™å‰ç«¯ã€‚
:star: è¿™é‡Œä½¿ç”¨äº†`SaToken`è¿›è¡Œç”¨æˆ·è®¤è¯å’Œé‰´æƒï¼Œä¾ç…§å®ƒçš„å®˜æ–¹æ–‡æ¡£éœ€è¦é…ç½®ä¸€ä¸ªæ‹¦æˆªå™¨ï¼Œæ‹¦æˆªå™¨ä¼šæ‹¦æˆªæ‰€æœ‰è¯·æ±‚ï¼Œç„¶ååˆ¤æ–­ç”¨æˆ·æ˜¯å¦ç™»å½•ï¼Œå¦‚æœç™»å½•äº†ï¼Œåˆ™ç»§ç»­æ‰§è¡Œï¼Œå¦åˆ™è·³è½¬åˆ°ç™»å½•é¡µé¢ã€‚

:o: é…ç½®`SaToken`æ‹¦æˆªå™¨ï¼Œåœ¨`config`åŒ…ä¸­
```java
package fun.tanc.selfclocking.config;

import cn.dev33.satoken.interceptor.SaInterceptor;
import cn.dev33.satoken.stp.StpUtil;
import org.springframework.context.annotation.Configuration;
import org.springframework.web.servlet.config.annotation.InterceptorRegistry;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;

@Configuration
public class SaTokenConfigure implements WebMvcConfigurer {
    // æ³¨å†Œæ‹¦æˆªå™¨
    @Override
    public void addInterceptors(InterceptorRegistry registry) {
        // æ³¨å†Œ Sa-Token æ‹¦æˆªå™¨ï¼Œæ ¡éªŒè§„åˆ™ä¸º StpUtil.checkLogin() ç™»å½•æ ¡éªŒã€‚
        registry.addInterceptor(new SaInterceptor(handle -> StpUtil.checkLogin()))
                .addPathPatterns("/**")
                .excludePathPatterns("/loginUser");
    }
}



```
:o: éšåå°±å¯ä»¥åœ¨Controlä½¿ç”¨äº†
```java
//UserControl.java
package fun.tanc.selfclocking.control;

import cn.dev33.satoken.annotation.SaCheckLogin;
import cn.dev33.satoken.stp.StpUtil;
import cn.dev33.satoken.util.SaResult;
import fun.tanc.selfclocking.model.UserModel;
import fun.tanc.selfclocking.service.UserServiceImpl;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;

import java.util.List;

@RestController
public class UserControl {
    @Autowired
    UserServiceImpl userService;

    //ç”¨æˆ·ç™»å½•
    @RequestMapping(value = "/loginUser",method = RequestMethod.GET)
    public SaResult loginUser(@RequestParam("username") String name,
                              @RequestParam("password") String password){
        //æŸ¥è¯¢ç”¨æˆ·æ˜¯å¦å­˜åœ¨
        UserModel user = userService.findUser(name);
        if (user == null){
            System.out.println("ç”¨æˆ·ä¸å­˜åœ¨");
            return SaResult.error("ç™»å½•å¤±è´¥:ç”¨æˆ·åæˆ–è€…å¯†ç é”™è¯¯");
        }

        //æŸ¥çœ‹å¯†ç æ˜¯å¦æ­£ç¡®
        if (user.getPassword().equals(password)){
            StpUtil.login(user.getId());
            String tokenValue = StpUtil.getTokenValue();
            return SaResult.ok("ç™»å½•æˆåŠŸ").setData(tokenValue);
        }else {
            return SaResult.error("ç™»å½•å¤±è´¥:ç”¨æˆ·åæˆ–è€…å¯†ç é”™è¯¯");
        }
    }

    //ç”¨æˆ·ç™»å‡º
    @RequestMapping(value = "/logoutUser",method = RequestMethod.GET)
    public SaResult logoutUser(){
        StpUtil.logout();
        return SaResult.ok("é€€å‡ºæˆåŠŸ");
    }

    //æ³¨å†Œç”¨æˆ·
    @RequestMapping(value = "/addUser",method = RequestMethod.POST)
    public Boolean addUser(@RequestParam("username") String name,
                           @RequestParam("password") String password){
        return userService.addUser(name,password);
    }


    //åˆ é™¤ç”¨æˆ·
    @RequestMapping(value = "/deleteUser",method = RequestMethod.DELETE)
    public Boolean deleteUser(@RequestParam("username") String username){
        return userService.deleteUser(username);
    }


    //æŸ¥æ‰¾ç”¨æˆ·(ç²¾ç¡®)
    @RequestMapping(value = "/findUser",method = RequestMethod.GET)
    public UserModel findUser(@RequestParam("username") String username){
        return userService.findUser(username);
    }

    //æŸ¥æ‰¾ç”¨æˆ·(æ¨¡ç³Š)
    @SaCheckLogin
    @RequestMapping(value = "/finderUserName",method = RequestMethod.GET)
    public List<UserModel> finderUserName(@RequestParam("name") String name){
        return userService.finderUserName(name);
    }

    @SaCheckLogin
    @RequestMapping(value = "/hello",method = RequestMethod.GET)
    public SaResult hello(){
        return SaResult.ok("hello");
    }
}

```

```java
//RelationshipControl.java
package fun.tanc.selfclocking.control;

import cn.dev33.satoken.annotation.SaCheckLogin;
import fun.tanc.selfclocking.service.RelationServiceImpl;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;

@RestController
public class RelationControl {
    @Autowired
    RelationServiceImpl relationService;

    //ç»‘å®šå…³ç³»
    @SaCheckLogin
    @RequestMapping(value ="/bindRelationship", method = RequestMethod.POST)
    public Boolean bindRelationship(@RequestParam("username") String userName,
                                    @RequestParam("friendname") String friendName,
                                    @RequestParam("relationship") String relationship)
    {
        return relationService.addRelation(userName,friendName,relationship);
    }

    //è§£ç»‘å…³ç³»
    @SaCheckLogin
    @RequestMapping(value = "/deleteRelationship",method = RequestMethod.DELETE)
    public Boolean deleteRelationship(@RequestParam("username") String userName,
                                      @RequestParam("friendname") String friendName)
    {
        return relationService.deleteRelation(userName,friendName);
    }
}

```

```java
//UserTaskControl.java
package fun.tanc.selfclocking.control;

import cn.dev33.satoken.annotation.SaCheckLogin;
import cn.dev33.satoken.stp.StpUtil;
import fun.tanc.selfclocking.model.UserTask;
import fun.tanc.selfclocking.service.UserTaskServiceImpl;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;

import java.util.List;

@RestController
public class UserTaskControl {
    @Autowired
    UserTaskServiceImpl userTaskService;


    //æ·»åŠ ä»»åŠ¡
    @SaCheckLogin
    @RequestMapping (value = "/addUserTask", method = RequestMethod.POST)
    public Boolean addUserTask(@RequestParam("username") String userName,
                               @RequestParam("taskname") String taskName,
                               @RequestParam("taskstr") String taskStr){
        return userTaskService.addUserTask(userName,taskName,taskStr);
    }


    //åˆ é™¤ä»»åŠ¡
    @SaCheckLogin
    @RequestMapping(value = "/deleteUserTask",method = RequestMethod.DELETE)
    public void deleteUserTask(@RequestParam("username") String userName,
                               @RequestParam("taskname") String taskName) {
        userTaskService.deleteUserTask(userName,taskName);
    }


    //æŸ¥è¯¢ä»»åŠ¡
    @SaCheckLogin
    @RequestMapping(value = "/findUserTask",method = RequestMethod.GET)
    public List<UserTask> findUserTask(@RequestParam("username") String userName) {
        List<UserTask> userTask = userTaskService.findUserTask(userName);
        userTask.forEach(x -> System.out.println(x.getTaskField()));
        return userTask;
    }

    //åˆ—å‡ºæ‰€æœ‰ä»»åŠ¡
    @SaCheckLogin
    @RequestMapping(value = "/finderUserTask",method = RequestMethod.GET)
    public List<UserTask> finderUserTask(@RequestParam("username") String userName) {
        StpUtil.getLoginId();
        List<UserTask> userTask = userTaskService.findUserTask(userName);
        userTask.forEach(x -> System.out.println(x.getTaskField()));
        return userTask;
    }
}

```